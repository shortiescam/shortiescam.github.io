<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Imposter - Find the Spy</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- Animation Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617; /* Slate 950 */
            color: #f8fafc;
            overflow: hidden; /* Prevent pull-to-refresh on mobile */
            -webkit-tap-highlight-color: transparent;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Smooth Gradients */
        .bg-glass {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Custom Animations */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 10s infinite;
        }
        .animation-delay-2000 {
            animation-delay: 2s;
        }
        .animation-delay-4000 {
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 3D Card Effects */
        .perspective-1000 {
            perspective: 1000px;
        }
        .preserve-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS (Inline SVGs) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Users: (props) => <Icon {...props} path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>} />,
            Play: (props) => <Icon {...props} path={<polygon points="5 3 19 12 5 21 5 3"/>} />,
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Refresh: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></>} />,
            Timer: (props) => <Icon {...props} path={<><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></>} />,
            Film: (props) => <Icon {...props} path={<><rect width="20" height="20" x="2" y="2" rx="2.18" ry="2.18"/><line x1="7" x2="7" y1="2" y2="22"/><line x1="17" x2="17" y1="2" y2="22"/><line x1="2" x2="22" y1="12" y2="12"/><line x1="2" x2="7" y1="7" y2="7"/><line x1="2" x2="7" y1="17" y2="17"/><line x1="17" x2="22" y1="17" y2="17"/><line x1="17" x2="22" y1="7" y2="7"/></>} />,
            Utensils: (props) => <Icon {...props} path={<><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></>} />,
            ShoppingBag: (props) => <Icon {...props} path={<><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></>} />,
            Cpu: (props) => <Icon {...props} path={<><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><path d="M9 1v3"/><path d="M15 1v3"/><path d="M9 20v3"/><path d="M15 20v3"/><path d="M20 9h3"/><path d="M20 14h3"/><path d="M1 9h3"/><path d="M1 14h3"/></>} />,
            Briefcase: (props) => <Icon {...props} path={<><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></>} />,
            Ghost: (props) => <Icon {...props} path={<><path d="M9 22v-2c0-.6.4-1 1-1h4a1 1 0 0 1 1 1v2"/><path d="M9 2h6"/><path d="M4 10v6a4 4 0 0 0 4 4h8a4 4 0 0 0 4-4v-6"/><path d="M12 2a8 8 0 0 0-8 8v2"/><path d="M20 12v-2a8 8 0 0 0-8-8"/></>} />, 
            Trophy: (props) => <Icon {...props} path={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></>} />,
            Globe: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></>} />,
            Music: (props) => <Icon {...props} path={<><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></>} />,
            MapPin: (props) => <Icon {...props} path={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>} />,
            Zap: (props) => <Icon {...props} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>} />,
            ChevronUp: (props) => <Icon {...props} path={<polyline points="18 15 12 9 6 15"/>} />,
            User: (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
            Eye: (props) => <Icon {...props} path={<><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></>} />,
            EyeOff: (props) => <Icon {...props} path={<><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></>} />,
            Lock: (props) => <Icon {...props} path={<><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>} />,
            Check: (props) => <Icon {...props} path={<polyline points="20 6 9 17 4 12"/>} />,
        };

        // --- DATA STORE ---
        const WORD_BANK = {
            Movies: ["The Godfather", "Titanic", "Avatar", "Star Wars", "Jurassic Park", "The Matrix", "Inception", "Forrest Gump", "The Lion King", "Avengers", "Pulp Fiction", "Frozen", "The Dark Knight", "Harry Potter", "Back to the Future", "Rocky", "Gladiator", "Shrek", "Toy Story", "Jaws", "Interstellar", "Parasite", "Coco", "Up", "Wall-E", "Alien", "Terminator", "Fight Club", "Goodfellas", "Spirited Away", "Barbie", "Oppenheimer", "Dune", "Spider-Man", "Black Panther", "Iron Man", "Wonder Woman", "Joker", "Top Gun", "The Shining", "Get Out", "Blade Runner", "E.T.", "Indiana Jones", "Schindler's List", "Lord of the Rings", "Silence of the Lambs", "Casablanca", "Citizen Kane"],
            Food: ["Pizza", "Sushi", "Burger", "Tacos", "Pasta", "Curry", "Steak", "Salad", "Sandwich", "Soup", "Fried Chicken", "Ramen", "Dumplings", "Burrito", "Pancakes", "Waffles", "Ice Cream", "Chocolate", "Cheese", "Bread", "Donuts", "Croissant", "Bagel", "Hot Dog", "Fries", "Lasagna", "Paella", "Kebab", "Falafel", "Dim Sum", "Pho", "Pad Thai", "Biryani", "Sashimi", "Tiramisu", "Cheesecake", "Pie", "Brownie", "Popcorn", "Nachos", "Guacamole", "Hummus", "Omelette", "Yogurt", "Bacon", "Sausage", "Risotto", "Gnocchi", "Pretzel", "Macaron"],
            Brands: ["Apple", "Nike", "Coca-Cola", "Samsung", "McDonalds", "Toyota", "Disney", "Amazon", "Google", "Tesla", "Adidas", "Pepsi", "Starbucks", "Netflix", "Microsoft", "Mercedes", "BMW", "Honda", "Sony", "Lego", "IKEA", "Zara", "H&M", "Gucci", "Louis Vuitton", "Rolex", "Canon", "Nikon", "PlayStation", "Xbox", "Spotify", "Uber", "Airbnb", "Facebook", "Instagram", "TikTok", "Twitter", "YouTube", "Visa", "Mastercard", "Ferrari", "Porsche", "Lamborghini", "Intel", "AMD", "Dell", "HP", "Adobe", "Slack", "Zoom"],
            Technology: ["iPhone", "Laptop", "Drone", "Robot", "Bluetooth", "Wifi", "Keyboard", "Mouse", "Monitor", "Camera", "Headphones", "Smartwatch", "Tablet", "Printer", "Router", "Server", "Microchip", "Satellite", "Telescope", "Microscope", "VR Headset", "Console", "Battery", "Charger", "USB", "Cloud", "Algorithm", "Internet", "Software", "Hardware", "Smartphone", "GPS", "Laser", "Radar", "Scanner", "Projector", "Speaker", "Microphone", "Webcam", "Flash Drive"],
            Jobs: ["Doctor", "Teacher", "Engineer", "Lawyer", "Chef", "Pilot", "Firefighter", "Police", "Artist", "Musician", "Actor", "Writer", "Scientist", "Programmer", "Designer", "Architect", "Nurse", "Dentist", "Vet", "Farmer", "Astronaut", "Athlete", "Judge", "Politician", "Journalist", "Photographer", "Mechanic", "Plumber", "Electrician", "Carpenter", "Librarian", "Accountant", "Manager", "CEO", "Secretary", "Receptionist", "Waiter", "Bartender", "Barber", "Soldier"],
            Mythology: ["Zeus", "Thor", "Hercules", "Medusa", "Dragon", "Unicorn", "Phoenix", "Mermaid", "Centaur", "Griffin", "Poseidon", "Hades", "Athena", "Apollo", "Odin", "Loki", "Anubis", "Ra", "Sphinx", "Hydra", "Cyclops", "Minotaur", "Pegasus", "Vampire", "Werewolf", "Ghost", "Zombie", "Elf", "Dwarf", "Giant", "Kraken", "Chimera", "Cerberus", "Valkyrie", "Fairy", "Goblin", "Troll", "Witch", "Wizard", "Demon"],
            Sport: ["Soccer", "Basketball", "Football", "Tennis", "Golf", "Cricket", "Rugby", "Baseball", "Volleyball", "Hockey", "Boxing", "MMA", "Wrestling", "Formula 1", "Swimming", "Athletics", "Gymnastics", "Cycling", "Skiing", "Surfing", "Skateboarding", "Snowboarding", "Table Tennis", "Badminton", "Bowling", "Pool", "Darts", "Archery", "Fencing", "Judo", "Karate", "Taekwondo", "Yoga", "Pilates", "Crossfit", "Marathon", "Triathlon", "Rowing", "Sailing", "Climbing"],
            Places: ["School", "Hospital", "Library", "Airport", "Station", "Park", "Beach", "Forest", "Mountain", "Desert", "City", "Village", "Farm", "Zoo", "Museum", "Cinema", "Mall", "Restaurant", "Hotel", "Bank", "Office", "Factory", "Prison", "Church", "Temple", "Mosque", "Stadium", "Gym", "Pool", "Casino", "Castle", "Palace", "Bridge", "Tower", "Skyscraper", "Lighthouse", "Pyramid", "Cave", "Island", "Volcano"],
            Instruments: ["Guitar", "Piano", "Drums", "Violin", "Flute", "Saxophone", "Trumpet", "Cello", "Harp", "Clarinet", "Trombone", "Tuba", "Banjo", "Ukulele", "Accordion", "Harmonica", "Xylophone", "Synthesizer", "Oboe", "Bass", "Microphone", "Turntable", "Speaker", "Amplifier", "Bongo", "Conga", "Tambourine", "Maracas", "Triangle", "Gong"],
            Superheroes: ["Superman", "Batman", "Spider-Man", "Iron Man", "Wonder Woman", "Thor", "Hulk", "Captain America", "Black Panther", "Flash", "Aquaman", "Green Lantern", "Wolverine", "Deadpool", "Doctor Strange", "Black Widow", "Hawkeye", "Ant-Man", "Daredevil", "Cyclops", "Storm", "Jean Grey", "Professor X", "Magneto", "Joker", "Thanos", "Loki", "Venom", "Groot", "Rocket"]
        };

        const CATEGORY_ICONS = {
            Movies: Icons.Film,
            Food: Icons.Utensils,
            Brands: Icons.ShoppingBag,
            Technology: Icons.Cpu,
            Jobs: Icons.Briefcase,
            Mythology: Icons.Ghost,
            Sport: Icons.Trophy,
            Places: Icons.MapPin,
            Instruments: Icons.Music,
            Superheroes: Icons.Zap
        };

        // --- COMPONENTS ---

        // 1. Setup Screen
        const SetupScreen = ({ onStartGame }) => {
            const DEFAULT_PLAYERS = ['Player 1', 'Player 2', 'Player 3'];
            const MIN_PLAYERS = 3;

            const [players, setPlayers] = useState(() => {
                try {
                    const saved = localStorage.getItem('imposter_players');
                    const loadedPlayers = saved ? JSON.parse(saved) : DEFAULT_PLAYERS;
                    return loadedPlayers.length >= MIN_PLAYERS ? loadedPlayers : DEFAULT_PLAYERS;
                } catch (e) {
                    return DEFAULT_PLAYERS;
                }
            });

            const [newPlayerName, setNewPlayerName] = useState('');
            const [selectedCategories, setSelectedCategories] = useState(['Movies', 'Food', 'Technology']);
            const [timerMinutes, setTimerMinutes] = useState(3);
            const [timerEnabled, setTimerEnabled] = useState(true);

            useEffect(() => {
                localStorage.setItem('imposter_players', JSON.stringify(players));
            }, [players]);

            const addPlayer = () => {
                if (newPlayerName.trim()) {
                    setPlayers([...players, newPlayerName.trim()]);
                    setNewPlayerName('');
                    if (navigator.vibrate) navigator.vibrate(10);
                }
            };

            const removePlayer = (index) => {
                if (players.length > MIN_PLAYERS) {
                    setPlayers(players.filter((_, i) => i !== index));
                    if (navigator.vibrate) navigator.vibrate(10);
                }
            };

            const toggleCategory = (cat) => {
                if (selectedCategories.includes(cat)) {
                    if (selectedCategories.length > 1) {
                        setSelectedCategories(selectedCategories.filter(c => c !== cat));
                        if (navigator.vibrate) navigator.vibrate(5);
                    }
                } else {
                    setSelectedCategories([...selectedCategories, cat]);
                    if (navigator.vibrate) navigator.vibrate(5);
                }
            };

            return (
                <div className="flex flex-col h-full overflow-y-auto bg-slate-950 text-white p-6 pb-28 no-scrollbar relative">
                    {/* Background Blobs */}
                    <div className="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
                         <div className="absolute top-0 -left-4 w-72 h-72 bg-purple-600 rounded-full mix-blend-multiply filter blur-[100px] opacity-20 animate-blob"></div>
                         <div className="absolute top-0 -right-4 w-72 h-72 bg-teal-600 rounded-full mix-blend-multiply filter blur-[100px] opacity-20 animate-blob animation-delay-2000"></div>
                         <div className="absolute -bottom-8 left-20 w-80 h-80 bg-blue-600 rounded-full mix-blend-multiply filter blur-[100px] opacity-20 animate-blob animation-delay-4000"></div>
                    </div>

                    <div className="relative z-10 max-w-lg mx-auto w-full">
                        <div className="mb-8 text-center pt-8">
                            <h1 className="text-6xl font-black text-white mb-2 tracking-tighter drop-shadow-lg">IMPOSTER</h1>
                            <p className="text-slate-400 text-xs font-bold tracking-[0.4em] uppercase">Trust No One</p>
                        </div>

                        {/* Players Section */}
                        <section className="mb-6 bg-glass rounded-[2rem] p-6">
                            <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-purple-300">
                                <Icons.Users size={20} /> <span className="tracking-tight">PLAYERS</span>
                                <span className="ml-auto text-xs bg-slate-800 px-3 py-1 rounded-full text-slate-400">{players.length} / {MIN_PLAYERS}+</span>
                            </h2>
                            <div className="flex gap-2 mb-4">
                                <input
                                    type="text"
                                    value={newPlayerName}
                                    onChange={(e) => setNewPlayerName(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && addPlayer()}
                                    placeholder="Enter name..."
                                    className="flex-1 bg-slate-800/50 rounded-2xl px-5 py-3.5 outline-none border border-slate-700/50 focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder:text-slate-600 font-medium text-sm"
                                />
                                <button 
                                    onClick={addPlayer}
                                    className="bg-purple-600 hover:bg-purple-500 w-12 h-[50px] flex items-center justify-center rounded-2xl font-bold transition shadow-lg shadow-purple-900/20 active:scale-95"
                                >
                                    <span className="text-xl leading-none">+</span>
                                </button>
                            </div>
                            <div className="flex flex-wrap gap-2">
                                {players.map((p, i) => (
                                    <div key={i} className="flex items-center gap-2 bg-slate-800/60 border border-slate-700/50 pl-4 pr-1.5 py-1.5 rounded-full animate-fadeIn group">
                                        <span className="text-sm font-semibold text-slate-200">{p}</span>
                                        <button 
                                            onClick={() => removePlayer(i)}
                                            disabled={players.length <= MIN_PLAYERS}
                                            className={`w-6 h-6 flex items-center justify-center rounded-full text-xs transition-colors 
                                                ${players.length > MIN_PLAYERS 
                                                    ? 'bg-slate-700 hover:bg-red-500 text-slate-400 hover:text-white' 
                                                    : 'bg-slate-800 text-slate-600 cursor-not-allowed'
                                                }`}
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </section>

                        {/* Timer Section */}
                        <section className="mb-6 bg-glass rounded-[2rem] p-6">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-lg font-bold flex items-center gap-2 text-blue-300">
                                    <Icons.Timer size={20} /> <span className="tracking-tight">TIMER</span>
                                </h2>
                                <button 
                                    onClick={() => {
                                        setTimerEnabled(!timerEnabled);
                                        if(navigator.vibrate) navigator.vibrate(10);
                                    }}
                                    className={`w-14 h-8 rounded-full p-1 transition-colors duration-300 ${timerEnabled ? 'bg-blue-600' : 'bg-slate-700'}`}
                                >
                                    <div className={`w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-300 ${timerEnabled ? 'translate-x-6' : 'translate-x-0'}`} />
                                </button>
                            </div>
                            
                            <div className={`transition-all duration-300 overflow-hidden ${timerEnabled ? 'opacity-100 max-h-40' : 'opacity-30 max-h-0'}`}>
                                <div className="flex justify-between items-center mb-4 bg-slate-800/50 p-4 rounded-2xl border border-slate-700/50">
                                    <span className="text-slate-400 text-xs font-bold uppercase tracking-wider">Duration</span>
                                    <span className="font-mono text-xl font-bold text-white">{timerMinutes} min</span>
                                </div>
                                <input
                                    type="range"
                                    min="1"
                                    max="15"
                                    value={timerMinutes}
                                    onChange={(e) => setTimerMinutes(parseInt(e.target.value))}
                                    className="w-full h-3 bg-slate-800 rounded-full appearance-none cursor-pointer accent-blue-500"
                                />
                            </div>
                        </section>

                        {/* Categories Section */}
                        <section className="mb-8">
                            <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-teal-300 px-2">
                                <Icons.Settings size={20} /> <span className="tracking-tight">CATEGORIES</span>
                            </h2>
                            <div className="grid grid-cols-2 gap-3">
                                {Object.keys(WORD_BANK).map(cat => {
                                    const IconComp = CATEGORY_ICONS[cat] || Icons.Globe;
                                    const isSelected = selectedCategories.includes(cat);
                                    return (
                                        <button
                                            key={cat}
                                            onClick={() => toggleCategory(cat)}
                                            className={`flex flex-col items-center justify-center gap-2 p-4 rounded-[1.5rem] border transition-all duration-200 active:scale-95 ${
                                                isSelected 
                                                    ? 'bg-teal-500/10 border-teal-500/50 text-teal-100 shadow-[0_0_15px_rgba(45,212,191,0.1)]' 
                                                    : 'bg-slate-900/40 border-slate-800 text-slate-500 hover:bg-slate-800'
                                            }`}
                                        >
                                            <IconComp size={24} className={isSelected ? "text-teal-400" : "text-slate-600"} />
                                            <span className="text-xs font-bold tracking-wide">{cat}</span>
                                        </button>
                                    )
                                })}
                            </div>
                        </section>
                    </div>

                    {/* Start Button */}
                    <div className="fixed bottom-0 left-0 w-full p-6 bg-gradient-to-t from-[#020617] via-[#020617] to-transparent z-50">
                        <div className="max-w-lg mx-auto">
                            <button
                                onClick={() => {
                                    if (players.length >= MIN_PLAYERS && selectedCategories.length > 0) {
                                        if (navigator.vibrate) navigator.vibrate(30);
                                        onStartGame(players, selectedCategories, timerEnabled ? timerMinutes * 60 : null);
                                    }
                                }}
                                disabled={players.length < MIN_PLAYERS || selectedCategories.length === 0}
                                className="w-full bg-white text-slate-950 font-black text-lg py-5 rounded-[1.5rem] shadow-xl shadow-white/10 disabled:opacity-50 disabled:shadow-none active:scale-[0.98] transition-all flex items-center justify-center gap-3"
                            >
                                <Icons.Play fill="currentColor" size={24} /> 
                                START GAME
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. Enhanced Card Reveal Flow
        const CardRevealScreen = ({ player, word, onNext, isLastPlayer }) => {
            // Steps: 'handover' -> 'identify' -> 'reveal'
            const [step, setStep] = useState('handover'); 
            const [isRevealed, setIsRevealed] = useState(false);
            const [swipeY, setSwipeY] = useState(0);

            // Reset state when player changes
            useEffect(() => {
                setStep('handover');
                setIsRevealed(false);
                setSwipeY(0);
            }, [player]);

            const handleTouchMove = (e) => {
                if (step !== 'identify') return;
                const touch = e.touches[0];
                // Simple logic: if user drags down significantly, reveal
                // Or if we want a "hold" button, we can do that too. 
                // Let's do a tap logic for simplicity but robust UI
            };

            const renderHandover = () => (
                <div className="flex flex-col items-center justify-center h-full text-center p-6 animate-slide-up">
                    <div className="w-24 h-24 bg-slate-800 rounded-full flex items-center justify-center mb-8 border border-slate-700">
                         <Icons.User size={48} className="text-slate-400" />
                    </div>
                    <h2 className="text-slate-500 text-sm font-bold uppercase tracking-[0.3em] mb-4">Pass Device To</h2>
                    <h1 className="text-5xl font-black text-white mb-12">{player}</h1>
                    
                    <div className="absolute bottom-10 w-full max-w-sm px-6">
                        <button 
                            onClick={() => {
                                setStep('identify');
                                if (navigator.vibrate) navigator.vibrate(20);
                            }}
                            className="w-full bg-slate-800 hover:bg-slate-700 border border-slate-600 text-white font-bold py-5 rounded-[1.5rem] transition-all active:scale-95 flex items-center justify-center gap-3"
                        >
                            <Icons.Check size={20} /> I am {player}
                        </button>
                    </div>
                </div>
            );

            const renderIdentity = () => (
                <div className="flex flex-col items-center justify-center h-full w-full p-6 relative">
                    <div className="absolute top-0 left-0 w-full h-full bg-slate-900/50 backdrop-blur-sm z-0"></div>
                    
                    {/* The Card */}
                    <div 
                        className="relative w-full max-w-xs aspect-[3/4] perspective-1000 z-10"
                        onClick={() => {
                            if (!isRevealed) {
                                setIsRevealed(true);
                                setStep('reveal');
                                if (navigator.vibrate) navigator.vibrate([30, 50]);
                            }
                        }}
                    >
                         <div className={`relative w-full h-full transition-transform duration-700 transform-style-3d preserve-3d cursor-pointer ${isRevealed ? 'rotate-y-180' : ''}`}>
                            
                            {/* Front (Hidden State) */}
                            <div className="absolute inset-0 backface-hidden">
                                <div className="w-full h-full bg-gradient-to-br from-slate-800 to-slate-900 rounded-[2.5rem] border border-slate-700 shadow-2xl flex flex-col items-center justify-center p-8 group">
                                    <div className="w-20 h-2 bg-slate-700 rounded-full mb-12 opacity-50"></div>
                                    <div className="w-32 h-32 bg-slate-800 rounded-full flex items-center justify-center mb-8 ring-4 ring-slate-800/50 group-hover:scale-105 transition-transform duration-500">
                                        <Icons.Lock size={48} className="text-slate-400" />
                                    </div>
                                    <h3 className="text-white font-black text-2xl mb-2">SECRET ROLE</h3>
                                    <p className="text-slate-400 font-medium text-sm">Tap card to reveal</p>
                                    <div className="absolute bottom-8 animate-bounce opacity-50">
                                        <Icons.Eye size={24} className="text-slate-400" />
                                    </div>
                                </div>
                            </div>

                            {/* Back (Revealed State) - Logic is handled in renderReveal to keep DOM clean, but for 3D flip effect we put content here visually if needed. 
                                However, to keep it simple and sleek, we will transition to renderReveal state fully. 
                                Actually, for the flip to work, we need the backface here.
                            */}
                             <div className="absolute inset-0 rotate-y-180 backface-hidden">
                                <div className={`w-full h-full rounded-[2.5rem] border shadow-2xl flex flex-col items-center justify-center p-8 ${
                                    word === "IMPOSTER" ? 'bg-red-950 border-red-500/30' : 'bg-teal-950 border-teal-500/30'
                                }`}>
                                     {/* Content mirrors renderReveal but just for the flip animation */}
                                     <div className="text-center">
                                        <p className="text-xs uppercase tracking-widest font-bold mb-4 opacity-50">Your Role</p>
                                        <h2 className="text-3xl font-black">{word}</h2>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderReveal = () => (
                 <div className="flex flex-col items-center justify-center h-full p-6 animate-fadeIn">
                    <div className={`w-full max-w-sm aspect-[3/4] rounded-[2.5rem] flex flex-col items-center justify-center p-8 text-center relative overflow-hidden shadow-2xl border ${
                         word === "IMPOSTER" 
                            ? 'bg-gradient-to-br from-red-950 to-slate-950 border-red-500/30' 
                            : 'bg-gradient-to-br from-teal-950 to-slate-950 border-teal-500/30'
                    }`}>
                        {/* Background Effects */}
                        <div className={`absolute top-0 w-full h-1/2 opacity-20 blur-3xl ${word === 'IMPOSTER' ? 'bg-red-500' : 'bg-teal-500'}`}></div>

                        <p className={`text-xs uppercase tracking-[0.3em] font-bold mb-8 ${word === 'IMPOSTER' ? 'text-red-300' : 'text-teal-300'}`}>Your Secret Role</p>
                        
                        {word === "IMPOSTER" ? (
                            <>
                                <div className="w-32 h-32 bg-red-500/10 rounded-full flex items-center justify-center mb-8 ring-1 ring-red-500/50 shadow-[0_0_40px_rgba(239,68,68,0.2)]">
                                    <span className="text-6xl">ü§´</span>
                                </div>
                                <h2 className="text-5xl font-black text-red-500 tracking-tighter mb-4 drop-shadow-sm">IMPOSTER</h2>
                                <p className="text-red-200/70 text-sm font-medium leading-relaxed max-w-[200px]">Blend in. Don't let them know you don't know the word.</p>
                            </>
                        ) : (
                            <>
                                <div className="w-32 h-32 bg-teal-500/10 rounded-full flex items-center justify-center mb-8 ring-1 ring-teal-500/50 shadow-[0_0_40px_rgba(20,184,166,0.2)]">
                                    <span className="text-6xl">üìù</span>
                                </div>
                                <h2 className="text-4xl font-black text-white mb-4 drop-shadow-sm">{word}</h2>
                                <p className="text-teal-200/70 text-sm font-medium leading-relaxed max-w-[200px]">This is the secret word. Remember it.</p>
                            </>
                        )}
                    </div>

                    <div className="w-full max-w-sm mt-8 px-2">
                        <button 
                            onClick={() => {
                                if(navigator.vibrate) navigator.vibrate(20);
                                onNext();
                            }}
                            className="w-full bg-white text-slate-950 py-5 rounded-[1.5rem] font-black shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3"
                        >
                            <Icons.EyeOff size={20} />
                            {isLastPlayer ? "HIDE & START GAME" : "HIDE & PASS"}
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="h-full bg-slate-950 relative overflow-hidden">
                    {/* Persistent Background */}
                    <div className="absolute inset-0 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-purple-600/5 rounded-full blur-[100px]"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-blue-600/5 rounded-full blur-[100px]"></div>
                    </div>

                    <div className="relative z-10 h-full">
                        {step === 'handover' && renderHandover()}
                        {step === 'identify' && renderIdentity()}
                        {step === 'reveal' && renderReveal()}
                    </div>
                </div>
            );
        };

        // 3. Game Timer Screen
        const GameTimerScreen = ({ duration, onEndGame, firstPlayer }) => {
            const [timeLeft, setTimeLeft] = useState(duration || 0);
            const [active, setActive] = useState(!!duration);

            useEffect(() => {
                if (!active || !duration) return;
                if (timeLeft <= 0) {
                    setActive(false);
                    if(navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 500]);
                    return;
                }
                const interval = setInterval(() => setTimeLeft(t => t - 1), 1000);
                return () => clearInterval(interval);
            }, [active, timeLeft, duration]);

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            };

            const progress = duration ? timeLeft / duration : 0;
            const strokeDasharray = 2 * Math.PI * 120;
            const strokeDashoffset = strokeDasharray * (1 - progress);

            return (
                <div className="h-full flex flex-col items-center justify-between bg-slate-950 p-6 text-white overflow-hidden relative">
                    {/* Background */}
                    <div className="absolute inset-0 pointer-events-none">
                        <div className={`absolute inset-0 bg-red-600/10 transition-opacity duration-1000 ${timeLeft < 30 && active ? 'opacity-100 animate-pulse' : 'opacity-0'}`}></div>
                    </div>

                    {/* Header: First Questioner Only - NO CATEGORY */}
                    <div className="w-full mt-8 bg-glass p-5 rounded-[1.5rem] flex items-center gap-4 z-10">
                        <div className="bg-indigo-500/20 p-3 rounded-full">
                            <Icons.Users size={24} className="text-indigo-300" />
                        </div>
                        <div>
                            <p className="text-indigo-300 text-[10px] uppercase font-bold tracking-wider mb-0.5">First Questioner</p>
                            <p className="text-white font-bold text-xl">{firstPlayer}</p>
                        </div>
                    </div>

                    {/* Main Timer Display */}
                    <div className="flex-1 flex flex-col items-center justify-center z-10 w-full relative">
                        {duration ? (
                            <div className="relative">
                                {/* Glow Effect */}
                                <div className={`absolute inset-0 rounded-full blur-[80px] transition-all duration-1000 ${timeLeft < 30 ? 'bg-red-500/20' : 'bg-blue-500/10'}`}></div>
                                
                                <div className="relative">
                                    <svg className="w-72 h-72 transform -rotate-90 drop-shadow-2xl">
                                        <circle cx="144" cy="144" r="120" stroke="#1e293b" strokeWidth="8" fill="transparent" />
                                        <circle 
                                            cx="144" cy="144" r="120" stroke="currentColor" strokeWidth="8" fill="transparent" 
                                            className={`${timeLeft < 30 ? 'text-red-500' : 'text-blue-500'} transition-colors duration-1000`}
                                            strokeDasharray={strokeDasharray}
                                            strokeDashoffset={strokeDashoffset}
                                            strokeLinecap="round"
                                        />
                                    </svg>
                                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                                        <span className={`text-7xl font-mono font-black tracking-tighter tabular-nums ${timeLeft < 30 ? 'text-red-500 animate-pulse' : 'text-white'}`}>
                                            {formatTime(timeLeft)}
                                        </span>
                                        <span className="text-slate-500 text-xs font-bold uppercase tracking-[0.3em] mt-4">
                                            {timeLeft === 0 ? "TIME'S UP" : "REMAINING"}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="text-center py-12 px-6 bg-slate-900/50 rounded-[2rem] border border-slate-800">
                                <div className="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <Icons.Timer size={32} className="text-slate-400" />
                                </div>
                                <h2 className="text-3xl font-black mb-3 text-white">Untimed Mode</h2>
                                <p className="text-slate-400 text-sm font-medium leading-relaxed max-w-xs mx-auto">Take your time. Ask questions. Watch for nervous habits.</p>
                            </div>
                        )}
                    </div>

                    {/* Action Button */}
                    <div className="w-full z-10 pb-6">
                        <button 
                            onClick={() => {
                                if(navigator.vibrate) navigator.vibrate(50);
                                onEndGame();
                            }}
                            className="w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white font-black text-xl py-5 rounded-[1.5rem] shadow-xl shadow-red-900/20 transition-all active:scale-[0.98] flex items-center justify-center gap-3 border border-red-500/20"
                        >
                            <Icons.Trophy size={24} fill="currentColor" />
                            REVEAL IMPOSTER
                        </button>
                    </div>
                </div>
            );
        };

        // 4. Results Screen
        const ResultScreen = ({ imposterName, word, onRestart }) => {
            return (
                <div className="h-full flex flex-col items-center justify-center bg-slate-950 p-6 text-white text-center overflow-hidden relative">
                    
                    <div className="relative mb-12 animate-float w-full max-w-sm">
                        <div className="absolute inset-0 bg-red-600 rounded-[3rem] blur-[60px] opacity-20"></div>
                        <div className="relative bg-gradient-to-br from-slate-900 to-slate-950 p-10 rounded-[2.5rem] border border-red-500/20 shadow-2xl">
                            <div className="text-xs font-bold text-red-400 uppercase tracking-[0.3em] mb-8">The Imposter Was</div>
                            <div className="w-24 h-24 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6">
                                <span className="text-5xl">ü§´</span>
                            </div>
                            <span className="text-4xl font-black text-white block break-words leading-tight">
                                {imposterName}
                            </span>
                        </div>
                    </div>

                    <div className="bg-glass p-6 rounded-[1.5rem] w-full max-w-sm mb-8">
                        <p className="text-slate-500 text-[10px] uppercase tracking-widest font-bold mb-2">The Secret Word</p>
                        <p className="text-2xl font-black text-teal-400">{word}</p>
                    </div>

                    <button 
                        onClick={() => {
                            if(navigator.vibrate) navigator.vibrate(20);
                            onRestart();
                        }}
                        className="w-full max-w-sm bg-white text-slate-950 py-5 rounded-[1.5rem] font-black text-lg shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3"
                    >
                        <Icons.Refresh size={20} /> PLAY AGAIN
                    </button>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [gameState, setGameState] = useState('setup'); 
            const [gameData, setGameData] = useState({
                players: [],
                imposterIndex: -1,
                secretWord: '',
                category: '',
                duration: null,
                firstPlayer: ''
            });
            const [currentPlayerIndex, setCurrentPlayerIndex] = useState(0);

            const startGame = (players, categories, duration) => {
                const randomCat = categories[Math.floor(Math.random() * categories.length)];
                const words = WORD_BANK[randomCat] || WORD_BANK['Movies'];
                const secretWord = words[Math.floor(Math.random() * words.length)];
                const imposterIndex = Math.floor(Math.random() * players.length);
                
                let potentialFirst = Math.floor(Math.random() * players.length);
                if (players.length > 2 && potentialFirst === imposterIndex) {
                    potentialFirst = (potentialFirst + 1) % players.length;
                }

                setGameData({
                    players,
                    imposterIndex,
                    secretWord,
                    category: randomCat, // Stored but hidden during game
                    duration,
                    firstPlayer: players[potentialFirst]
                });
                
                setCurrentPlayerIndex(0);
                setGameState('pass');
            };

            const handleNextPlayer = () => {
                if (currentPlayerIndex < gameData.players.length - 1) {
                    setCurrentPlayerIndex(prev => prev + 1);
                } else {
                    setGameState('active');
                }
            };

            const handleEndGame = () => setGameState('result');
            const handleRestart = () => setGameState('setup');

            return (
                <div className="w-full h-screen overflow-hidden bg-slate-950 font-sans select-none text-slate-100">
                    {gameState === 'setup' && (
                        <SetupScreen onStartGame={startGame} />
                    )}

                    {gameState === 'pass' && (
                        <CardRevealScreen 
                            key={currentPlayerIndex} // Forces remount for state reset
                            player={gameData.players[currentPlayerIndex]}
                            word={currentPlayerIndex === gameData.imposterIndex ? "IMPOSTER" : gameData.secretWord}
                            onNext={handleNextPlayer}
                            isLastPlayer={currentPlayerIndex === gameData.players.length - 1}
                        />
                    )}

                    {gameState === 'active' && (
                        <GameTimerScreen 
                            duration={gameData.duration}
                            onEndGame={handleEndGame}
                            firstPlayer={gameData.firstPlayer}
                        />
                    )}

                    {gameState === 'result' && (
                        <ResultScreen 
                            imposterName={gameData.players[gameData.imposterIndex]}
                            word={gameData.secretWord}
                            onRestart={handleRestart}
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
